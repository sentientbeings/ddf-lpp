/* This is the main module for the game Hanseatic League, developed by David Friedman, and	*//* implemented by Tom Courtney. Copyright 1989.												*//*																							*//* Roadmap:																					*//*																							*//* city.c		city object																	*//* file.c		process the File menu choice												*//* main.c		Macintosh & game initializations, main event loop.							*//* shift.c		move the map around										*//* terrain.c	create terrain, report interesting hex information							*//* turtle.c		simple turtle graphics.														*//* utilities.c	useful procedures that don't go anywhere else.								*//* windows.c	create the map window, draw map, update map.								*/#include "mainMapmaker.h"#include "mainMapmakerP.h"int errno;Boolean doCommand( mResult )long mResult;{	register int		theItem;	register Str255		name;	register WindowPeek	wPtr;		theItem = LoWord( mResult );	switch (HiWord(mResult)) {	case appleID:		GetItem(myMenus[appleM], theItem, &name);		OpenDeskAcc(&name );		SetPort( GetMapWindow() );		break;	case fileID: 		DoFile(theItem);		break;	case terrainID:		ChangeMapType(myMenus[terrainM], theItem);		break;			case shiftID:		ShiftMap(theItem);		break;			}	HiliteMenu(0);	return(true);}void main() {	short 			city;	Rect			dragRect;	int				item;	EventRecord		myEvent;	Boolean			notDone;	WindowPtr		whichWindow;	InitGraf(&thePort);	InitFonts();	FlushEvents( everyEvent, 0 );	InitWindows();	InitMenus();	TEInit();	InitDialogs(0L);	InitCursor();	MaxApplZone();	GetDateTime(&randSeed);	setUpMenus();	notDone = true;	SetRect(&dragRect, 0, 0, 1024, 1024);	do {		SystemTask();		if (GetNextEvent(everyEvent, &myEvent)) {			switch (myEvent.what) {			case mouseDown:				switch (FindWindow( myEvent.where, &whichWindow )) {				case inMenuBar:					notDone = doCommand(MenuSelect(myEvent.where));					break;				case inSysWindow:					SystemClick( &myEvent, whichWindow );					break;				case inDrag:					if (ours(whichWindow))						DragWindow( whichWindow, myEvent.where, &dragRect );					break;				case inContent:					if (whichWindow != FrontWindow())						SelectWindow(whichWindow);					if (ours(whichWindow))						DoContent(whichWindow, &myEvent, singleClick);					break;				} /* end switch FindWindow */				break;			case keyDown:			case autoKey: 				{				register char	theChar;							theChar = myEvent.message & charCodeMask;				if ((myEvent.modifiers & cmdKey) != 0) 					notDone =  doCommand( MenuKey( theChar ) );				}				break;			case updateEvt: 				if (ours((WindowPtr)myEvent.message)) 					UpdateWindow((WindowPtr)myEvent.message);				break;								} /* end of case myEvent.what */		} /* if */	} while (notDone);}Boolean ours(w)WindowPtr w;{	return (w==GetMapWindow());}void setUpMenus(){	register int i;		myMenus[appleM] = NewMenu( appleID, "\p\024" );	AddResMenu( myMenus[appleM], 'DRVR' );	myMenus[fileM] = GetMenu(fileID);	myMenus[editM] = GetMenu(editID);	myMenus[terrainM] = GetMenu(terrainID); 	myMenus[optionsM] = GetMenu(optionsID);	myMenus[shiftM] = GetMenu(shiftID);	for ( (i=appleM); (i < numberOfMenus); i++ ) InsertMenu(myMenus[i], 0) ;	DrawMenuBar();}