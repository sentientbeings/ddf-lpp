/* This is the file module for the game Hanseatic League. It is responsible for all 		*//* processing of file menu items.															*/#include "fileMapmaker.h"#include "fileMapmakerP.h"/* external procedures *//* go process a menu item */static 	Str255 		fn;Boolean DoFile( item )int		item;{	Handle		c;	SFTypeList	myTypes;	int 		vRef, refNum;	Point 	SFGwhere;	SetPt(&SFGwhere, 90, 82);	switch (item) {		case fmNew: 		InitCityNameObject();		InitRiverTable();		InitTerrainTable();		CreateCityInfoObject();		InitCoastTable();		HideCursor();		initWorld();		InitCities();		SetUpWindows();		ShowCursor();		SetNumberOfCities(0);		break;			case fmSaveAs:		reply.fName[0] = 0; /* intentional fallthrough */			case fmSave:		saveFile();		break;					case fmResume:		myTypes[0]='HNSH';		SFGetFile( SFGwhere, "\p", 0L, 1, myTypes, 0L, &reply );		if (reply.good) {			InitRiverTable();			InitTerrainTable();			refNum = OpenResFile(reply.fName);			restoreGame(false);			CloseResFile(refNum);			pStrCopy((char *) reply.fName, (char *)&fn);			gameInProgress = true;		}		break;			case fmQuit: 		ExitToShell();	}	return(true);}/* local procedures */Boolean newFile( fn, vRef )Str255	*fn;int		*vRef;{	Point SFPwhere;	SFReply reply;	SFPwhere.h = 90;	SFPwhere.v = 82;	SFPutFile(SFPwhere, "\p", fn, 0L, &reply);	if (reply.good) {		pStrCopy((char *) reply.fName, (char *)fn);		*vRef = reply.vRefNum;		return true;	}	else return false;}void initWorld(){	int i, j;	Point p;		for (i = 0; i < rowSize; i++)		for (j = 0; j < columnSize; j++) {		SetPt(&p, i, j);		SetTerrainType(i, j, same, noTerrainType);		SetRiverType(i, j, same, noRiver);		SetCoastType(p, noCoast);	}}void restoreGame(useSavedValues)Boolean useSavedValues;{	short i, j;	Point hex;		InitSaveMap();	RestoreCityData();  	RestoreTerrainInfo();	RestoreCoastInfo();	DrawMap(true);	for (i = 0; i < rowSize; i++)		for (j = 0; j < columnSize; j++) {			hex.h = i;			hex.v = j;			if (IsCityHere(i, j, same))				DrawCity(hex);		}	SaveMap();}Boolean saveFile(){	int refNum, numberOfEntries, i;	Point	SFPwhere;		if (reply.fName[0]==0) {		SetPt(&SFPwhere, 106, 104);		SFPutFile(SFPwhere, "\p", "\pSaved Game", 0L, &reply);		if (!reply.good)			return false;	}	FSDelete(reply.fName, reply.vRefNum);	FlushVol("\p", reply.vRefNum);	Create(reply.fName, reply.vRefNum, 'HANS', 'HNSH');	CreateResFile(reply.fName);	if ((refNum = OpenResFile(reply.fName)) != -1) {		saveGame(); 		CloseResFile(refNum); 		FlushVol("\p", reply.vRefNum);		return true;	} else {		ReportError((StringPtr) "\psaveFile", ResError(), (StringPtr) "\pError creating file ", (StringPtr) reply.fName); 		return false;	}}void saveGame(){	int city1, city2;		UpdateWindow(GetMapWindow());	if (GetNumberOfCities() > 0) {		for (city1 = 0; city1 < GetNumberOfCities(); city1++) {			SetLeague(city1, 0);			SetSilkProductionCost(city1, 0);			SetTransportValue(city1, city1, baseLabor+1);			GetTransportCosts(city1, city1, wheat);		}		SaveCityInfo();	}	SaveTerrainInfo();	SaveCoastInfo();}